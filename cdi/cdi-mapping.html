<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>CDI MAPPING</title>

  <!-- ===== PWA (CDI) ===== -->
  <link rel="manifest" href="cdi.webmanifest?v=3">
  <meta name="theme-color" content="#0e0f13">

  <!-- iOS A2HS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CDI Map">
  <link rel="apple-touch-icon" href="/assets/icon-192.png">

  <!-- ===== iOS STARTUP IMAGES (LAUNCH SCREEN) =====
       Taruh file PNG ini di: /cdi/assets/splash/
  -->
  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-640x1136.png"
        media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">

  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-750x1334.png"
        media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">

  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-828x1792.png"
        media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">

  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-1125x2436.png"
        media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">

  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-1170x2532.png"
        media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">

  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-1242x2208.png"
        media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">

  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-1242x2688.png"
        media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">

  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-1284x2778.png"
        media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">

  <!-- iPad -->
  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-1536x2048.png"
        media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">

  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-1668x2224.png"
        media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">

  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-1668x2388.png"
        media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">

  <link rel="apple-touch-startup-image" href="/cdi/assets/splash/startup-2048x2732.png"
        media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">

  <link rel="stylesheet" href="css/style.css" />

  <style>
    :root{
      --topbar-h: 56px;
      --dock-h: 56px;
      --ui-zoom: 1;
      --vh: 1vh;
    }

    html, body{
      width:100%;
      height: calc(var(--vh) * 100);
      margin:0;
      overflow:hidden;
      overscroll-behavior:none;
      background:#0e0f13;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      height:var(--topbar-h);
    }
    .top-actions{
      display:flex;
      align-items:center;
      gap:10px;
      margin-left:auto;
    }

    .chip-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      height:36px;
      padding:0 14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.35);
      color:#fff;
      font-weight:700;
      letter-spacing:.04em;
      font-size:12px;
      cursor:pointer;
      backdrop-filter: blur(8px);
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      white-space:nowrap;
    }
    .chip-btn:active{ transform:scale(.98); }

    .menu-wrapper{ position:relative; }
    .menu-wrapper .menu-btn{
      height:36px;
      width:44px;
      padding:0;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.35);
      color:#fff;
      font-size:18px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .menu-dropdown{
      top:44px !important;
      right:0 !important;
      z-index:999999;
    }

    #appRoot{
      height: calc(var(--vh) * 100);
      width:100vw;
      position:relative;
      overflow:hidden;
    }

    .bg-image{ position:fixed; inset:0; }

    /* ======================================================
       FIX: padding bawah ikut ZOOM
       - zoom out -> padding mengecil -> mapping makin lega
    ====================================================== */
    #workspace{
      position:absolute;
      top:var(--topbar-h);
      left:0;
      right:0;
      bottom:0;

      overflow:auto;
      -webkit-overflow-scrolling:touch;
      overscroll-behavior:contain;

      padding-bottom: calc((var(--dock-h) + env(safe-area-inset-bottom) + 12px) * var(--ui-zoom));
      box-sizing:border-box;
    }
    #workspace::-webkit-scrollbar{ display:none; }

    #workspaceInner{
      transform-origin: top left;
      transform: scale(var(--ui-zoom));
      width: calc(100% / var(--ui-zoom));
      min-height: 100%;
    }

    /* Override style.css kalau ada content yang maksa 100vh */
    #workspace #contentArea.content{
      height:auto !important;
      min-height:100% !important;
      overflow:visible !important;
    }
    #workspace .content{
      overflow:visible !important;
    }

    /* ===== DOCK ZOOM bawah ===== */
    .zoom-dock{
      position:fixed;
      left:50%;
      bottom: calc(10px + env(safe-area-inset-bottom));
      transform:translateX(-50%);
      z-index:999998;

      height:46px;
      display:flex;
      align-items:center;
      gap:10px;
      padding:8px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.40);
      backdrop-filter: blur(10px);
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      touch-action: manipulation;
    }
    .zoom-dock .zbtn{
      height:34px;
      min-width:40px;
      padding:0 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.35);
      color:#fff;
      font-weight:900;
      cursor:pointer;
    }
    .zoom-dock .zbtn:active{ transform:scale(.98); }
    .zoom-dock .zrange{ width:140px; accent-color:#ffffff; }
    .zoom-dock .zlabel{
      font-size:12px;
      color:#fff;
      opacity:.85;
      min-width:44px;
      text-align:right;
    }

    /* ===== TOOLTIP fixed ===== */
    .hint{
      position:fixed;
      z-index:999997;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.35);
      color:#fff;
      font-size:12px;
      backdrop-filter: blur(10px);
      opacity:0;
      transform: translateY(4px);
      transition: .25s ease;
      pointer-events:none;
    }
    .hint.show{ opacity:1; transform: translateY(0); }
    .hint-right{ right:10px; top:50%; transform:translateY(-50%); }
    .hint-bottom{
      left:50%;
      bottom: calc((var(--dock-h) + env(safe-area-inset-bottom) + 12px) * var(--ui-zoom));
      transform:translateX(-50%);
    }

    @media (max-width:420px){
      :root{ --dock-h: 60px; }
      .chip-btn{ padding:0 10px; font-size:11px; height:34px; }
      .menu-wrapper .menu-btn{ height:34px; width:40px; }
      .zoom-dock .zrange{ width:110px; }
      .zoom-dock .zlabel{ min-width:40px; }
    }

    @media (orientation: landscape){
      :root{ --dock-h: 46px; }
      .zoom-dock{
        height:40px;
        padding:6px 10px;
        bottom: calc(6px + env(safe-area-inset-bottom));
      }
      .zoom-dock .zbtn{ height:30px; min-width:38px; }
      .zoom-dock .zlabel{ font-size:11px; }
    }

    #curveCanvas{ touch-action:none; }

    /* ======================================================
       SPLASH (HTML) + LOADING BAR
       (Perubahan hanya di bagian ini)
       - Logo tetap di tengah
       - Bar + teks diturunkan ke tengah-bawah
    ====================================================== */
    #splash{
      position:fixed;
      inset:0;
      z-index:9999999;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#0e0f13;
      opacity:1;
      transition: opacity .25s ease;
    }
    #splash.hide{
      opacity:0;
      pointer-events:none;
    }
    .splash-inner{
      width:min(420px, 88vw);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:18px;
      transform: translateY(-50px);
       /* ✅ jangan geser container, biar logo tidak ikut turun */
    }
    .splash-logo{
      width:min(320px, 70vw);
      height:auto;
      image-rendering:auto;
      user-select:none;
      -webkit-user-drag:none;
    }

    .splash-bar{
      /* ✅ yang diturunkan cuma bar (bukan logo) */
      margin-top: 800px;          /* atur ini kalau mau lebih turun */
      width:min(360px, 86vw);     /* ✅ lebih panjang */
      height:6px;
      border-radius:999px;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      position:relative;
    }
    .splash-bar::before{
      content:"";
      position:absolute;
      left:-40%;
      top:0;
      height:100%;
      width:40%;
      border-radius:999px;
      background:rgba(0,255,100,.9);
      filter: drop-shadow(0 0 8px rgba(0,255,100,.35));
      animation: splashMove 1.1s ease-in-out infinite;
    }
    @keyframes splashMove{
      0%{ left:-40%; width:35%; }
      50%{ left:30%;  width:45%; }
      100%{ left:110%; width:35%; }
    }

    .splash-note{
      margin-top: 10px;           /* ✅ ikut turun rapi */
      font-size:12px;
      color:rgba(255,255,255,.70);
      letter-spacing:.04em;
    }
  </style>
</head>

<body>

<!-- ===== SPLASH HTML ===== -->
<div id="splash" aria-hidden="false">
  <div class="splash-inner">
    <img class="splash-logo" src="/assets/logo.png" alt="SMT Racing">
    <div class="splash-bar" aria-label="Loading"></div>
    <div class="splash-note">LOADING...</div>
  </div>
</div>

<div id="appRoot">

  <header class="topbar">
    <div class="title">CDI MAPPING</div>

    <div class="top-actions">
      <button id="installBtn" class="chip-btn" type="button" style="display:none;">⬇ INSTALL</button>

      <div class="menu-wrapper">
        <button class="menu-btn" type="button" onclick="toggleMenu()" aria-label="Menu">☰</button>
        <div id="menuDropdown" class="menu-dropdown hidden">
          <div onclick="selectCDI('basic')">CDI POWER BAND A1</div>
          <div onclick="selectCDI('dual')">CDI POWER SMT A2</div>
          <div onclick="selectCDI('racing')">CDI POWER SMT A3</div>
        </div>
      </div>
    </div>
  </header>

  <div class="bg-image"></div>

  <div id="hintRight" class="hint hint-right">Drag titik: sentuh & tarik di titik hijau</div>
  <div id="hintBottom" class="hint hint-bottom">Zoom pakai tab bawah</div>

  <div id="workspace">
    <div id="workspaceInner">
      <div id="contentArea" class="content empty">
        <div class="empty-text">Pilih tipe CDI melalui menu ☰</div>
      </div>
    </div>
  </div>

  <div class="zoom-dock" id="zoomDock">
    <button class="zbtn" id="zoomOutBtn" type="button">−</button>
    <input class="zrange" id="zoomRange" type="range" min="40" max="160" value="100">
    <button class="zbtn" id="zoomInBtn" type="button">+</button>
    <div class="zlabel" id="zoomLabel">100%</div>
  </div>

</div>

<script src="js/app.js"></script>
<script src="js/esp/esp-api.js"></script>
<script src="js/esp/esp-api-dual.js"></script>
<script src="js/cdi-basic/cdi-basic.js"></script>
<script src="js/cdi-basic/cdi-basic-live.js"></script>
<script src="js/cdi-dual/cdi-dual.js"></script>
<script src="js/cdi-dual/cdi-dual-live.js"></script>
<script src="js/cdi-racing/cdi-racing.js"></script>

<script>
/* ===== FIX VH untuk HP (rotate + address bar) ===== */
(function(){
  function getH(){
    if (window.visualViewport && typeof window.visualViewport.height === "number"){
      return window.visualViewport.height;
    }
    return window.innerHeight;
  }
  function setVH(){
    const h = getH();
    document.documentElement.style.setProperty('--vh', (h * 0.01) + 'px');
  }
  setVH();
  window.addEventListener('resize', setVH, {passive:true});
  if (window.visualViewport){
    window.visualViewport.addEventListener('resize', setVH, {passive:true});
  }
  window.addEventListener('orientationchange', () => {
    setTimeout(setVH, 250);
    setTimeout(setVH, 600);
  }, {passive:true});
})();
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ===== SPLASH CONTROL =====
     - Dibuat oleh HTML (bukan icon aplikasi)
     - Dibuat sedikit delay (maks 2 detik)
  */
  const splash = document.getElementById('splash');
  let splashGone = false;

  const SPLASH_MIN_MS = 10000;  // minimal tampil (biar tidak terlalu cepat)
  const SPLASH_MAX_MS = 12000;  // maksimal tampil (sesuai permintaan)
  const splashStart = Date.now();

  function hideSplash(){
    if (splashGone) return;
    splashGone = true;
    splash.classList.add('hide');
    setTimeout(() => { splash.style.display = 'none'; }, 350);
  }

  function hideWithMinDelay(){
    const elapsed = Date.now() - splashStart;
    const wait = Math.max(0, SPLASH_MIN_MS - elapsed);
    setTimeout(hideSplash, wait);
  }

  // hilang ketika semua resource selesai (CSS/JS/images)
  window.addEventListener('load', () => {
    hideWithMinDelay();
  }, { once:true });

  // fallback: kalau load nyangkut, tetap hilang maksimal 2 detik
  setTimeout(hideSplash, SPLASH_MAX_MS);

  /* ===== ZOOM UI ===== */
  const zoomRange = document.getElementById('zoomRange');
  const zoomInBtn = document.getElementById('zoomInBtn');
  const zoomOutBtn = document.getElementById('zoomOutBtn');
  const zoomLabel = document.getElementById('zoomLabel');

  function setZoomPct(pct){
    const clamped = Math.max(40, Math.min(160, pct));
    const z = clamped / 100;
    document.documentElement.style.setProperty('--ui-zoom', z.toFixed(3));
    zoomRange.value = String(clamped);
    zoomLabel.textContent = clamped + "%";
  }
  setZoomPct(100);

  zoomRange.addEventListener('input', () => setZoomPct(parseInt(zoomRange.value,10) || 100));
  zoomInBtn.addEventListener('click', () => setZoomPct((parseInt(zoomRange.value,10) || 100) + 5));
  zoomOutBtn.addEventListener('click', () => setZoomPct((parseInt(zoomRange.value,10) || 100) - 5));

  /* ===== HINT ===== */
  const hintRight = document.getElementById('hintRight');
  const hintBottom = document.getElementById('hintBottom');
  let hintTimer = null;
  function showHints(){
    clearTimeout(hintTimer);
    hintRight.classList.add('show');
    hintBottom.classList.add('show');
    hintTimer = setTimeout(() => {
      hintRight.classList.remove('show');
      hintBottom.classList.remove('show');
    }, 3500);
  }
  showHints();

  /* ===== PWA INSTALL ===== */
  const installBtn = document.getElementById('installBtn');
  let deferredPrompt = null;

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = 'inline-flex';
  });

  installBtn.addEventListener('click', async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
    installBtn.style.display = 'none';
  });

  window.addEventListener('appinstalled', () => {
    installBtn.style.display = 'none';
  });

  /* ===== SW ===== */
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/cdi/service-worker.js").catch(()=>{});
  }
});
</script>

</body>
</html>




